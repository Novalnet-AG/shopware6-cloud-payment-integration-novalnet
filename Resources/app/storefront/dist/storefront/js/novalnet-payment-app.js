(window.webpackJsonp=window.webpackJsonp||[]).push([["novalnet-payment-app"],{kd4G:function(e,t,n){"use strict";n.r(t);var o=n("FGIj"),r=n("3xtq"),a=n("prSB"),u=n("k8s9"),i=n("p4AR"),c=n("2Y4b"),l=n("gHbT"),s=n("477Q");function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function y(e,t){return!t||"object"!==m(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var h=function(e){function t(){return d(this,t),y(this,f(t).apply(this,arguments))}var n,o,m;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}(t,e),n=t,(o=[{key:"init",value:function(){this._createScript((function(){document.querySelectorAll('input[name="paymentMethodId"]');var e=document.querySelector("input[name=paymentMethodId]:checked"),t=document.querySelector("#nnAppPaymentId"),n=document.querySelector('#confirmOrderForm button[type="submit"]'),o=this,m=new NovalnetPaymentForm,d="nnPaymentNameCookie",p=new u.a,y=new i.a,f=a.a.getItem(d),v=t.closest("form"),h=l.a.getDataAttribute(o.el,"data-lineitems",!1),S=!0;if(t.value===e.value&&(S=!1),fetch("https://extapi.novalnet.de/shopware/public/nn/loadIframe",{method:"POST",body:JSON.stringify({customerId:document.querySelector("#customerId").value,languageId:document.querySelector("#languageId").value,currency:document.querySelector("#nnCurrency").value,amount:document.querySelector("#nnAmount").value,shopId:document.querySelector("#shopId").value})}).then((function(e){return e.json()})).then((function(e){"FAILURE"==e.result.status||100!=e.result.status_code?(alert(e.result.additional_message),document.getElementById("novalnetV13Iframe").style.display="none"):(document.getElementById("novalnetV13Iframe").style.background="unset",document.getElementById("novalnetV13Iframe").src=e.result.redirect_url)})).catch((function(e){document.getElementById("novalnetV13Iframe").style.display="none",console.error("Error:",e)})),!1===a.a.getItem(d)||void 0===a.a.getItem(d)||S||t.value!==e.value){var b={iframe:"#novalnetV13Iframe",initForm:{orderInformation:{lineItems:h,billing:{requiredFields:[]}},uncheckPayments:S,setWalletPending:!0,showButton:!1}};m.initiate(b),m.validationResponse((function(e){m.initiate(b)}))}else{var g={iframe:"#novalnetV13Iframe",initForm:{orderInformation:{lineItems:h,billing:{requiredFields:[]}},checkPayment:f,uncheckPayments:!1,setWalletPending:!0,showButton:!1}};m.initiate(g),m.validationResponse((function(e){m.initiate(g)}))}m.selectedPayment((function(o){if(a.a.setItem(d,o.payment_details.type),t.value!==e.value){r.a.create(),document.querySelector("#paymentMethod"+t.value).checked=!0;var u=c.a.serialize(v),i=v.getAttribute("action");p.post(i,u,(function(e){r.a.remove(),window.PluginManager.initializePlugins(),document.querySelector("#nnAppPaymentId").closest("form").submit()}))}"GOOGLEPAY"==o.payment_details.type||"APPLEPAY"==o.payment_details.type?n.style.display="none":n.style.display="block"})),m.walletResponse({onProcessCompletion:function(e){if("SUCCESS"==e.result.status){var t=document.querySelector("#tos");return null==t||t.checked?(document.querySelector("#novalnetapp-paymentdata").value=JSON.stringify(e),y.post("store-api/script/customer-update",JSON.stringify({paymentData:JSON.stringify(e),customerId:document.querySelector("#customerId").value}),""),setTimeout((function(){fetch("https://extapi.novalnet.de/shopware/public/novalnet/saveSession",{method:"POST",body:JSON.stringify({paymentData:JSON.stringify(e),shopId:document.querySelector("#shopId").value,customerNo:document.querySelector("#customerNo").value})}).then((function(e){})).catch((function(e){})),document.querySelector("#confirmOrderForm").submit()}),500),{status:"SUCCESS",statusText:"successfull"}):{status:"FAILURE",statusText:"failure"}}return{status:"FAILURE",statusText:"failure"}}}),n.addEventListener("click",(function(n){if(t.value===e.value){var r=document.querySelector("#tos");if(null!=r&&!r.checked)return!1;if(n.preventDefault(),n.stopImmediatePropagation(),null!=document.getElementById("confirmFormSubmit"))document.getElementById("confirmFormSubmit").disabled=!0,new s.a(document.getElementById("confirmFormSubmit")).create();else{var a=document.querySelector('#confirmOrderForm button[type="submit"]');a.disabled=!0,new s.a(a).create()}m.getPayment((function(e){"100"==e.result.statusCode||"SUCCESS"==e.result.status?null!=e.payment_details.key&&null!=e.payment_details.key?(document.querySelector("#novalnetapp-paymentdata").value=JSON.stringify(e),y.post("store-api/script/customer-update",JSON.stringify({paymentData:JSON.stringify(e),customerId:document.querySelector("#customerId").value}),""),setTimeout((function(){fetch("https://extapi.novalnet.de/shopware/public/novalnet/saveSession",{method:"POST",body:JSON.stringify({paymentData:JSON.stringify(e),shopId:document.querySelector("#shopId").value,customerNo:document.querySelector("#customerNo").value})}).then((function(e){})).catch((function(e){})),document.querySelector("#confirmOrderForm").submit()}),500)):(o._displayErrorMsg("Please select any payment method"),o._showSubmitForm()):(o._displayErrorMsg(e.result.message),o._showSubmitForm())}))}}))}))}},{key:"_createScript",value:function(e){var t="https://cdn.novalnet.de/js/pv13/checkout.js?"+Math.floor(1000009*Math.random()),n=document.createElement("script");n.type="text/javascript",n.src=t,n.addEventListener("load",e.bind(this),!1),document.head.appendChild(n)}},{key:"_displayErrorMsg",value:function(e){document.querySelector(".flashbags").innerHTML="";var t=document.createElement("div"),n=document.createElement("div"),o=document.createElement("div"),r=document.createElement("span");t.className="alert alert-danger alert-has-icon",n.className="alert-content-container",o.className="alert-content",r.className="icon icon-blocked",r.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24" height="24" viewBox="0 0 24 24"><defs><path d="M12 24C5.3726 24 0 18.6274 0 12S5.3726 0 12 0s12 5.3726 12 12-5.3726 12-12 12zm0-2c5.5228 0 10-4.4772 10-10S17.5228 2 12 2 2 6.4772 2 12s4.4772 10 10 10zm4.2929-15.7071c.3905-.3905 1.0237-.3905 1.4142 0 .3905.3905.3905 1.0237 0 1.4142l-10 10c-.3905.3905-1.0237.3905-1.4142 0-.3905-.3905-.3905-1.0237 0-1.4142l10-10z" id="icons-default-blocked"></path></defs><use xlink:href="#icons-default-blocked" fill="#758CA3" fill-rule="evenodd"></use></svg>',t.appendChild(r),t.appendChild(n),n.appendChild(o),o.innerHTML=e,document.querySelector(".flashbags").appendChild(t),document.querySelector(".flashbags").scrollIntoView()}},{key:"_showSubmitForm",value:function(){if(null!=document.getElementById("confirmFormSubmit"))document.getElementById("confirmFormSubmit").disabled=!1,new s.a(document.getElementById("confirmFormSubmit")).remove();else{var e=document.querySelector('#confirmOrderForm button[type="submit"]');e.disabled=!1,new s.a(e).remove()}}}])&&p(n.prototype,o),m&&p(n,m),t}(o.a);window.PluginManager.register("NovalnetAppPayment",h,"#novalnet-app-payment-script")}},[["kd4G","runtime","vendor-node","vendor-shared"]]]);